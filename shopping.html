<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的购物车-小米商城</title>
    <link rel="icon" href="./img/mi-logo .ico">

    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/shopping.css">
    <link rel="stylesheet" href="./layui/css/layui.css">
</head>

<body>
    <!-- 头部 -->
    <header class="site-header site-mini-header">
        <div class="container">
            <!-- 仿米logo -->
            <div class="header-logo">
                <a class="logo ir" href="http://localhost/xiaomi/index.html">仿米官网</a>
            </div>
            <!-- 标题 -->
            <div class="header-title has-more" id="J_miniHeaderTitle">
                <h2>我的购物车</h2>
                <p class="hide" id="tips">温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算</p>

            </div>
            <div class="topbar-info" id="J_userInfonone">
                <a class="link" href="http://localhost/xiaomi/login.html">登录</a>
                <span class="sep">|</span>
                <a class="link" href="http://localhost/xiaomi/login.html?register">注册</a>
            </div>
        </div>
    </header>
    <!-- 主体 -->
    <section class="page-main">
        <div class="container">
            <!-- 购物车为空 -->
            <div class="cart-empty " id="J_cartEmpty">
                <h2>您的购物车还是空的！</h2>
                <p class="login-desc">登录后将显示您之前加入的商品</p>
                <a href="login.html" class="btn btn-primary btn-login" id="J_loginBtn">立即登录</a>
                <a href="index.html" class="btn" id="J_Shoping">马上去购物</a>
            </div>
            <!-- 购物车有商品时 -->
            <div class="cart-goods-list hide" id="J_cartListGoods">
                <div class="title clearfix">
                    <div class="checkAll leftfix">
                        <input type="checkbox" name="" id="" class="check-all" checked>
                        全选
                    </div>
                    <div class="spl leftfix"></div>
                    <div class="name leftfix">商品名称</div>
                    <div class="price leftfix">单价</div>
                    <div class="number leftfix">数量</div>
                    <div class="xiaoji leftfix">小计</div>
                    <div class="handle leftfix">操作</div>
                </div>
                <div class="content clearfix">
                    <!-- <div class="clearfix shop">
                        <div class="checkAll leftfix">
                            <input type="checkbox" name="" id="">
                        </div>
                        <div class="spl leftfix"><a href=""><img src="./img/xiaomi10s.jpg" alt=""></a></div>
                        <div class="name leftfix"><a href="">小米10S 8GB+128GB 黑色</a></div>
                        <div class="price leftfix">2799元</div>
                        <div class="number leftfix clearfix">
                            <a href="" class="leftfix">-</a>
                            <span class="leftfix count">1</span>
                            <a href="" class="rightfix">+</a>
                        </div>
                        <div class="xiaoji leftfix ">2799元</div>
                        <div class="handle leftfix">
                            <a href="" class="del">×</a>
                        </div>
                    </div> -->
                </div>

                <!-- 结算 -->
                <div class="settlement clearfix">
                    <div class="left leftfix">
                        <a href="http://localhost/xiaomi/index.html">继续购物</a>
                        <span>共 <i id="sumNum">1</i> 件商品，已选择 <i id="checked-num">0</i>件</span>
                    </div>
                    <div class="right rightfix">
                        合计: <i id="totalMoney">0</i>元
                        <a href="javascript:void(0);" id="settle">去结算</a>
                        <div class="selected">
                            请勾选需要结算的商品
                            <i class="arrow arrow-a"></i>
                            <i class="arrow arrow-b"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 商品列表 -->
            <div class="goodslist">
                <h2><span>买购物车中商品的人还买了</span></h2>
                <ul class="clearfix" id="goodslist-ul">
                    <!-- <li><a href="">
                            <img src="./img/goods1.webp" alt="">
                            <h2>小米10S 素皮保护壳</h2>
                            <p>99元</p>
                            <div class="review">3.6万人好评</div>

                        </a>
                        <div class="addCart layui-anim layui-anim-up">
                            <a href="">加入购物车</a>
                        </div>
                        <div class="success-add layui-anim layui-anim-down">成功加入购物车</div>
                    </li> -->

                </ul>
            </div>
        </div>
    </section>
    <!-- 页脚 -->
    <div class="footer">
        <div class="container">
            <div class="footer-service">
                <ul class="list-service clearfix">
                    <li>
                        <a href="#">
                            <i class="iconfont icon-weixiu"></i>
                            预约维修服务
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="iconfont icon-tianwuliyoutuihuo"></i>
                            7天无理由退货
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="iconfont icon-15tianmianfeihuanhuo24px"></i>
                            15天免费换货
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="iconfont icon-man150yuanbaoyou24px"></i>
                            满150元包邮
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="iconfont icon-520jiashouhouwangdian24px"></i>
                            520余家售后网点
                        </a>
                    </li>
                </ul>
            </div>
            <div class="footer-link">
                <dl class="col-links">
                    <dt>帮助中心</dt>
                    <dd>
                        <a href="">账户管理</a>
                    </dd>
                    <dd>
                        <a href="">购物指南</a>
                    </dd>
                    <dd>
                        <a href="">订单操作</a>
                    </dd>
                </dl>
                <dl class="col-links">
                    <dt>服务支持</dt>
                    <dd>
                        <a href="">售后政策</a>
                    </dd>
                    <dd>
                        <a href="">自助服务</a>
                    </dd>
                    <dd>
                        <a href="">相关下载</a>
                    </dd>
                </dl>
                <dl class="col-links">
                    <dt>线下门店</dt>
                    <dd>
                        <a href="">小米之家</a>
                    </dd>
                    <dd>
                        <a href="">服务网点</a>
                    </dd>
                    <dd>
                        <a href="">授权体验店</a>
                    </dd>
                </dl>
                <dl class="col-links">
                    <dt>关于小米</dt>
                    <dd>
                        <a href="">了解小米</a>
                    </dd>
                    <dd>
                        <a href="">加入小米</a>
                    </dd>
                    <dd>
                        <a href="">投资者关系</a>
                    </dd>
                </dl>
                <dl class="col-links">
                    <dt>关注我们</dt>
                    <dd>
                        <a href="">新浪微博</a>
                    </dd>
                    <dd>
                        <a href="">官方微信</a>
                    </dd>
                    <dd>
                        <a href="">联系我们</a>
                    </dd>
                </dl>
                <dl class="col-links">
                    <dt>特色服务</dt>
                    <dd>
                        <a href="">F码通道</a>
                    </dd>
                    <dd>
                        <a href="">礼物码</a>
                    </dd>
                    <dd>
                        <a href="">防伪查询</a>
                    </dd>
                </dl>
                <div class="col-contact">
                    <p class="tel">400-100-5678</p>
                    <p>周一至周日 8:00-18:00<br>(仅收市话费)</p>
                    <a href="#" class="customer-contact">
                        <i class="fa fa-commenting-o" aria-hidden="true"></i>
                        联系客服
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- 声明信息 -->
    <div class="site-info">
        <div class="container">
            <div class="logo ir"></div>
            <div class="info-text">
                <p class="sites">
                    <a rel="nofollow" href="index.html" target="_blank">仿米商城</a>
                    <span class="sep">|</span>
                    <a href="javascript:;">MIUI</a>
                    <span class="sep">|</span>
                    <a href="javascript:;">米家</a>
                    <span class="sep">|</span>
                    <a href="http://www.miliao.com/">米聊</a>
                    <span class="sep">|</span>
                    <a href="//www.duokan.com/">多看</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">游戏</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">政企服务</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">仿米天猫店</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">仿米集团隐私政策</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">仿米公司儿童信息保护规则</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">仿米商城隐私政策</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">仿米商城用户协议</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">问题反馈</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">廉正举报</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">诚信合规</a>
                    <span class="sep">|</span>
                    <a rel="nofollow" href="javascript:;">Select Location</a>
                </p>
                <p>
                    ©
                    <a href="javascript:;">mi.com</a> 京ICP证110507号
                    <a href="http://beian.miit.gov.cn/">京ICP备10046444号</a>
                    <a rel="nofollow" href="javascript:;">京公网安备11010802020134号</a>
                    <a href="//www.mi.com/culture-license/">京网文[2017]1530-131号</a><br>
                    <a href="//www.mi.com/medical/record/">（京）网械平台备字（2018）第00005号</a>
                    <a href="//www.mi.com/medical/qualification/">互联网药品信息服务资格证 (京)-非经营性-2014-0090</a>
                    <a href="//www.mi.com/business-license/">营业执照</a>
                    <a href="//www.mi.com/medical/list/">医疗器械质量公告</a> <br>
                    <a
                        href="//cdn.cnbj1.fds.api.mi-img.com/mi-mall/af5b8ef38e7d57c5ee7fa4289ccf4df8.png">增值电信业务许可证</a>&nbsp;网络食品经营备案（京）【2018】WLSPJYBAHF-12&nbsp;
                    <a href="//cdn.cnbj1.fds.api.mi-img.com/mi-mall/fe7383e11127caea371f17156f429a1e.png">食品经营许可证</a>
                    <br>
                    违法和不良信息举报电话：185-0130-1238&nbsp;<a
                        href="//www.mi.com/static/intellectual/index.html">知识产权侵权投诉</a>&nbsp;本网站所列数据，除特殊说明，所有数据均出自我司实验室测试
                </p>
            </div>
            <div class="info-links">
                <a href="javascript:;"><img src="img/xm1.png" alt=""></a>
                <a href="javascript:;"><img src="img/xm2.png" alt=""></a>
                <a href="javascript:;"><img src="img/xm3.png" alt=""></a>
                <a href="javascript:;"><img src="img/xm4.png" alt=""></a>
                <a href="javascript:;"><img src="img/xm5.png" alt=""></a>
            </div>
        </div>
        <div class="slogan ir">探索黑科技，仿米为发烧而生</div>
    </div>
    <!-- 引入js -->
    <script src="./js/jquery-3.3.1.js"></script>
    <script src="./layui/layui.js"></script>
    <script src="./layer/layer.js"></script>

    <script src="./js/ajax.js"></script>
    <script src="./js/shopping.js" charset="UTF-8"></script>
    <script>
        //1.构造json数据，每一个json数据就是一个商品
        ajax.get('http://localhost/xiaomi/json/cartGoods.json').then(data => {
            // console.log(JSON.parse(data));
            let html = '';
            // 先转化成对象再遍历
            JSON.parse(data).forEach(goods => {
                html += `<li><a href="">
                        <img src="${goods.src}" alt="">
                        <h2>${goods.name}</h2>
                        <p>${goods.price}元</p>
                        <div class="review">${goods.review}</div>

                    </a>
                    <div class="addCart layui-anim layui-anim-up" onclick="addCart(${goods.id},'${goods.src}','${goods.name}','${goods.price}',1,this)">
                        <a href="javascript:void(0)">加入购物车</a>
                    </div>
                    <div class="success-add layui-anim layui-anim-down">成功加入购物车</div>
                </li>` //传入参数时记得加单引号
            });
            $$('#goodslist-ul').innerHTML = html;
        });
        //点击加入购物车事件绑定、
        function addCart(id, src, name, price, num, that) {
            //1.获取存入浏览器中的购物车数据
            // console.log(that);
            let successObj = that.nextElementSibling;
            // console.log(successObj);
            let goodsData = localStorage.getItem('carts');
            // console.log(goodsData);
            //2.浏览器中的购物车中有数据
            if (goodsData) {
                goodsData = JSON.parse(goodsData);
                //判断点击的商品是否在购物车中存在
                let flag = false;
                goodsData.forEach(v => {
                    if (v.id == id) { //存在
                        v.num = v.num - 0 + (num - 0); //记得数据类型转换
                        flag = true;
                    }
                });
                if (!flag) { //不存在
                    goodsData.push({
                        id,
                        src,
                        name,
                        price,
                        num
                    });
                }
                localStorage.setItem('carts', JSON.stringify(goodsData));
            } else { //无数据
                let obj = {
                    id,
                    src,
                    name,
                    price,
                    num
                };
                let goodsArr = [obj]; //以数组的形式保存
                localStorage.setItem('carts', JSON.stringify(goodsArr));

            }
            successObj.style.display = 'block';
            //0.3s后刷新页面
            let time = setTimeout(() => {
                location.reload();
            }, 300);
        }
    </script>
</body>

</html>